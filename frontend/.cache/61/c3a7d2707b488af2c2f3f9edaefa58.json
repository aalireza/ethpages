{"id":"node_modules/uport-transports/lib/transport/qr.js","dependencies":[{"name":"/Users/sashavol/Misc/ethdenver-keybook/frontend/package.json","includedInParent":true,"mtime":1550371955498},{"name":"/Users/sashavol/Misc/ethdenver-keybook/frontend/node_modules/uport-transports/package.json","includedInParent":true,"mtime":1550368277431},{"name":"/Users/sashavol/Misc/ethdenver-keybook/frontend/node_modules/uport-transports/.babelrc","includedInParent":true,"mtime":499162500000},{"name":"nets","loc":{"line":10,"column":20},"parent":"/Users/sashavol/Misc/ethdenver-keybook/frontend/node_modules/uport-transports/lib/transport/qr.js","resolved":"/Users/sashavol/Misc/ethdenver-keybook/frontend/node_modules/nets/index.js"},{"name":"./ui","loc":{"line":14,"column":18},"parent":"/Users/sashavol/Misc/ethdenver-keybook/frontend/node_modules/uport-transports/lib/transport/qr.js","resolved":"/Users/sashavol/Misc/ethdenver-keybook/frontend/node_modules/uport-transports/lib/transport/ui/index.js"},{"name":"./../message/util.js","loc":{"line":16,"column":20},"parent":"/Users/sashavol/Misc/ethdenver-keybook/frontend/node_modules/uport-transports/lib/transport/qr.js","resolved":"/Users/sashavol/Misc/ethdenver-keybook/frontend/node_modules/uport-transports/lib/message/util.js"},{"name":"./messageServer","loc":{"line":18,"column":29},"parent":"/Users/sashavol/Misc/ethdenver-keybook/frontend/node_modules/uport-transports/lib/transport/qr.js","resolved":"/Users/sashavol/Misc/ethdenver-keybook/frontend/node_modules/uport-transports/lib/transport/messageServer.js"}],"generated":{"js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.send = exports.chasquiCompress = exports.chasquiSend = undefined;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _nets = require('nets');\n\nvar _nets2 = _interopRequireDefault(_nets);\n\nvar _ui = require('./ui');\n\nvar _util = require('./../message/util.js');\n\nvar _messageServer = require('./messageServer');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar POLLING_INTERVAL = 2000;\n\n/**\n * A QR tranpsort which uses our provided QR modal to relay a request to a uPort client,\n * optionally compressing the provided message if a compress function is provided\n *\n * @param    {String}       displayText   dialog used in qr modal display\n * @return   {Function}                   a configured QRTransport Function\n *   @param    {String}       message            a uport client request message\n *   @param    {Object}       [opts={}]\n *   @param    {Function}     [opts.cancel]      cancel callback, called on modal close\n *   @param    {Function}     [opts.compress]    a function to compress a JWT, returning a promise that resolves to a string\n *   @return   {Function}                        a function to close the QR modal\n */\nvar send = function send(displayText) {\n  return function (message) {\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        cancel = _ref.cancel,\n        compress = _ref.compress;\n\n    if (compress) {\n      compress(message).then(function (msg) {\n        return (0, _ui.open)(msg, cancel, displayText);\n      }).catch(function (err) {\n        console.error(err);\n        // Display failure modal and allow retry\n        (0, _ui.failure)(function () {\n          return send(displayText)(message, { cancel: cancel, compress: compress });\n        });\n      });\n    } else {\n      var uri = (0, _util.messageToURI)(message);\n      uri = /callback_type=/.test(uri) ? uri : (0, _util.paramsToQueryString)(uri, { callback_type: 'post' });\n      (0, _ui.open)(uri, cancel, displayText);\n    }\n\n    // Return close function immediately, UI is async anyway\n    return _ui.close;\n  };\n};\n\n/**\n * A utility function for reducing the size of a QR code by uploading it to chasqui and\n * replacing the contents with the topic url.\n *\n * An empty Verification JWT (i.e. with signature and sub/iss but blank claim) is ~250 characters\n * The absolute max that can fit in a scanable QR on the screen is ~1500 characters\n * Below 650 characters the QR modal fits perfectly in the browser on a 13\" MBP, with some wiggle room\n *\n * @param   {String}  message     the request JWT\n * @param   {Number}  threshold   the smallest size (in string length) to compress\n * @returns {String}  the chasqui url of the message, or the original message if less than threshold\n */\nvar chasquiCompress = function chasquiCompress(message) {\n  var threshold = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Number.MAX_VALUE;\n\n  return new Promise(function (resolve, reject) {\n    if (message.length < threshold) {\n      var uri = (0, _util.messageToURI)(message);\n      uri = /callback_type=/.test(uri) ? uri : (0, _util.paramsToQueryString)(uri, { callback_type: 'post' });\n      resolve(uri);\n      return;\n    }\n    // Trim message and extract query params\n    var topic = _extends({\n      message: message.replace(/\\?.*/, '')\n    }, (0, _util.getUrlQueryParams)(message));\n    (0, _nets2.default)({\n      uri: _messageServer.CHASQUI_URL + 'topic/',\n      method: 'POST',\n      body: JSON.stringify(topic),\n      headers: {\n        'content-type': 'application/json'\n      },\n      withCredentials: false,\n      rejectUnauthorized: false\n    }, function (err, response) {\n      if (err) reject(err);else if (response.statusCode !== 201) reject(new Error('Failed to create topic'));else {\n        var _uri = '' + _messageServer.CHASQUI_URL + (response.headers.location || response.headers.Location);\n        resolve(_uri);\n      }\n    });\n  });\n};\n\n/**\n *  A QR Code and Chasqui Transport. The QR modal is configured for tranporting the request, while the\n *  response will be returned through Chasqui.\n *\n *  @param    {Object}       [config={}]               an optional config object\n *  @param    {String}       [config.chasquiUrl]       url of messaging server, defaults to Chasqui instance run by uPort\n *  @param    {String}       [config.pollingInterval]  milisecond interval at which the messaging server will be polled for a response\n *  @return   {Function}                               a configured QRTransport Function\n *  @param    {String}       message                   a uPort client request message\n *  @return   {Promise<Object, Error>}                 a function to close the QR modal\n */\nvar chasquiSend = function chasquiSend() {\n  var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      _ref2$chasquiUrl = _ref2.chasquiUrl,\n      chasquiUrl = _ref2$chasquiUrl === undefined ? _messageServer.CHASQUI_URL : _ref2$chasquiUrl,\n      _ref2$pollingInterval = _ref2.pollingInterval,\n      pollingInterval = _ref2$pollingInterval === undefined ? POLLING_INTERVAL : _ref2$pollingInterval,\n      displayText = _ref2.displayText;\n\n  var transport = (0, _messageServer.URIHandlerSend)(send(displayText, { compress: chasquiCompress }), { chasquiUrl: chasquiUrl, pollingInterval: pollingInterval });\n  return function (message, params) {\n    return transport(message, params).then(function (res) {\n      (0, _ui.close)();\n      return res;\n    }, function (err) {\n      (0, _ui.close)();\n      throw new Error(err);\n    });\n  };\n};\n\nexports.chasquiSend = chasquiSend;\nexports.chasquiCompress = chasquiCompress;\nexports.send = send;","map":{"mappings":[{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":2,"column":0},"generated":{"line":2,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":3,"column":0},"generated":{"line":3,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":4,"column":0},"generated":{"line":4,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":5,"column":0},"generated":{"line":5,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":6,"column":0},"generated":{"line":6,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":7,"column":0},"generated":{"line":7,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":8,"column":0},"generated":{"line":8,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":9,"column":0},"generated":{"line":9,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":10,"column":0},"generated":{"line":10,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":11,"column":0},"generated":{"line":11,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":12,"column":0},"generated":{"line":12,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":13,"column":0},"generated":{"line":13,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":14,"column":0},"generated":{"line":14,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":15,"column":0},"generated":{"line":15,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":16,"column":0},"generated":{"line":16,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":17,"column":0},"generated":{"line":17,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":18,"column":0},"generated":{"line":18,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":19,"column":0},"generated":{"line":19,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":20,"column":0},"generated":{"line":20,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":21,"column":0},"generated":{"line":21,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":22,"column":0},"generated":{"line":22,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":23,"column":0},"generated":{"line":23,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":24,"column":0},"generated":{"line":24,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":25,"column":0},"generated":{"line":25,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":26,"column":0},"generated":{"line":26,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":27,"column":0},"generated":{"line":27,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":28,"column":0},"generated":{"line":28,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":29,"column":0},"generated":{"line":29,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":30,"column":0},"generated":{"line":30,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":31,"column":0},"generated":{"line":31,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":32,"column":0},"generated":{"line":32,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":33,"column":0},"generated":{"line":33,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":34,"column":0},"generated":{"line":34,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":35,"column":0},"generated":{"line":35,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":36,"column":0},"generated":{"line":36,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":37,"column":0},"generated":{"line":37,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":38,"column":0},"generated":{"line":38,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":39,"column":0},"generated":{"line":39,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":40,"column":0},"generated":{"line":40,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":41,"column":0},"generated":{"line":41,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":42,"column":0},"generated":{"line":42,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":43,"column":0},"generated":{"line":43,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":44,"column":0},"generated":{"line":44,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":45,"column":0},"generated":{"line":45,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":46,"column":0},"generated":{"line":46,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":47,"column":0},"generated":{"line":47,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":48,"column":0},"generated":{"line":48,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":49,"column":0},"generated":{"line":49,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":50,"column":0},"generated":{"line":50,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":51,"column":0},"generated":{"line":51,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":52,"column":0},"generated":{"line":52,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":53,"column":0},"generated":{"line":53,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":54,"column":0},"generated":{"line":54,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":55,"column":0},"generated":{"line":55,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":56,"column":0},"generated":{"line":56,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":57,"column":0},"generated":{"line":57,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":58,"column":0},"generated":{"line":58,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":59,"column":0},"generated":{"line":59,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":60,"column":0},"generated":{"line":60,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":61,"column":0},"generated":{"line":61,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":62,"column":0},"generated":{"line":62,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":63,"column":0},"generated":{"line":63,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":64,"column":0},"generated":{"line":64,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":65,"column":0},"generated":{"line":65,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":66,"column":0},"generated":{"line":66,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":67,"column":0},"generated":{"line":67,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":68,"column":0},"generated":{"line":68,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":69,"column":0},"generated":{"line":69,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":70,"column":0},"generated":{"line":70,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":71,"column":0},"generated":{"line":71,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":72,"column":0},"generated":{"line":72,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":73,"column":0},"generated":{"line":73,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":74,"column":0},"generated":{"line":74,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":75,"column":0},"generated":{"line":75,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":76,"column":0},"generated":{"line":76,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":77,"column":0},"generated":{"line":77,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":78,"column":0},"generated":{"line":78,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":79,"column":0},"generated":{"line":79,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":80,"column":0},"generated":{"line":80,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":81,"column":0},"generated":{"line":81,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":82,"column":0},"generated":{"line":82,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":83,"column":0},"generated":{"line":83,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":84,"column":0},"generated":{"line":84,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":85,"column":0},"generated":{"line":85,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":86,"column":0},"generated":{"line":86,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":87,"column":0},"generated":{"line":87,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":88,"column":0},"generated":{"line":88,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":89,"column":0},"generated":{"line":89,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":90,"column":0},"generated":{"line":90,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":91,"column":0},"generated":{"line":91,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":92,"column":0},"generated":{"line":92,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":93,"column":0},"generated":{"line":93,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":94,"column":0},"generated":{"line":94,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":95,"column":0},"generated":{"line":95,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":96,"column":0},"generated":{"line":96,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":97,"column":0},"generated":{"line":97,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":98,"column":0},"generated":{"line":98,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":99,"column":0},"generated":{"line":99,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":100,"column":0},"generated":{"line":100,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":101,"column":0},"generated":{"line":101,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":102,"column":0},"generated":{"line":102,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":103,"column":0},"generated":{"line":103,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":104,"column":0},"generated":{"line":104,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":105,"column":0},"generated":{"line":105,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":106,"column":0},"generated":{"line":106,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":107,"column":0},"generated":{"line":107,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":108,"column":0},"generated":{"line":108,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":109,"column":0},"generated":{"line":109,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":110,"column":0},"generated":{"line":110,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":111,"column":0},"generated":{"line":111,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":112,"column":0},"generated":{"line":112,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":113,"column":0},"generated":{"line":113,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":114,"column":0},"generated":{"line":114,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":115,"column":0},"generated":{"line":115,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":116,"column":0},"generated":{"line":116,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":117,"column":0},"generated":{"line":117,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":118,"column":0},"generated":{"line":118,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":119,"column":0},"generated":{"line":119,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":120,"column":0},"generated":{"line":120,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":121,"column":0},"generated":{"line":121,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":122,"column":0},"generated":{"line":122,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":123,"column":0},"generated":{"line":123,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":124,"column":0},"generated":{"line":124,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":125,"column":0},"generated":{"line":125,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":126,"column":0},"generated":{"line":126,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":127,"column":0},"generated":{"line":127,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":128,"column":0},"generated":{"line":128,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":129,"column":0},"generated":{"line":129,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":130,"column":0},"generated":{"line":130,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":131,"column":0},"generated":{"line":131,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":132,"column":0},"generated":{"line":132,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":133,"column":0},"generated":{"line":133,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":134,"column":0},"generated":{"line":134,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":135,"column":0},"generated":{"line":135,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":136,"column":0},"generated":{"line":136,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":137,"column":0},"generated":{"line":137,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":138,"column":0},"generated":{"line":138,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":139,"column":0},"generated":{"line":139,"column":0}},{"source":"node_modules/uport-transports/lib/transport/qr.js","original":{"line":140,"column":0},"generated":{"line":140,"column":0}}],"sources":{"node_modules/uport-transports/lib/transport/qr.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.send = exports.chasquiCompress = exports.chasquiSend = undefined;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _nets = require('nets');\n\nvar _nets2 = _interopRequireDefault(_nets);\n\nvar _ui = require('./ui');\n\nvar _util = require('./../message/util.js');\n\nvar _messageServer = require('./messageServer');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar POLLING_INTERVAL = 2000;\n\n/**\n * A QR tranpsort which uses our provided QR modal to relay a request to a uPort client,\n * optionally compressing the provided message if a compress function is provided\n *\n * @param    {String}       displayText   dialog used in qr modal display\n * @return   {Function}                   a configured QRTransport Function\n *   @param    {String}       message            a uport client request message\n *   @param    {Object}       [opts={}]\n *   @param    {Function}     [opts.cancel]      cancel callback, called on modal close\n *   @param    {Function}     [opts.compress]    a function to compress a JWT, returning a promise that resolves to a string\n *   @return   {Function}                        a function to close the QR modal\n */\nvar send = function send(displayText) {\n  return function (message) {\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        cancel = _ref.cancel,\n        compress = _ref.compress;\n\n    if (compress) {\n      compress(message).then(function (msg) {\n        return (0, _ui.open)(msg, cancel, displayText);\n      }).catch(function (err) {\n        console.error(err);\n        // Display failure modal and allow retry\n        (0, _ui.failure)(function () {\n          return send(displayText)(message, { cancel: cancel, compress: compress });\n        });\n      });\n    } else {\n      var uri = (0, _util.messageToURI)(message);\n      uri = /callback_type=/.test(uri) ? uri : (0, _util.paramsToQueryString)(uri, { callback_type: 'post' });\n      (0, _ui.open)(uri, cancel, displayText);\n    }\n\n    // Return close function immediately, UI is async anyway\n    return _ui.close;\n  };\n};\n\n/**\n * A utility function for reducing the size of a QR code by uploading it to chasqui and\n * replacing the contents with the topic url.\n *\n * An empty Verification JWT (i.e. with signature and sub/iss but blank claim) is ~250 characters\n * The absolute max that can fit in a scanable QR on the screen is ~1500 characters\n * Below 650 characters the QR modal fits perfectly in the browser on a 13\" MBP, with some wiggle room\n *\n * @param   {String}  message     the request JWT\n * @param   {Number}  threshold   the smallest size (in string length) to compress\n * @returns {String}  the chasqui url of the message, or the original message if less than threshold\n */\nvar chasquiCompress = function chasquiCompress(message) {\n  var threshold = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Number.MAX_VALUE;\n\n  return new Promise(function (resolve, reject) {\n    if (message.length < threshold) {\n      var uri = (0, _util.messageToURI)(message);\n      uri = /callback_type=/.test(uri) ? uri : (0, _util.paramsToQueryString)(uri, { callback_type: 'post' });\n      resolve(uri);\n      return;\n    }\n    // Trim message and extract query params\n    var topic = _extends({\n      message: message.replace(/\\?.*/, '')\n    }, (0, _util.getUrlQueryParams)(message));\n    (0, _nets2.default)({\n      uri: _messageServer.CHASQUI_URL + 'topic/',\n      method: 'POST',\n      body: JSON.stringify(topic),\n      headers: {\n        'content-type': 'application/json'\n      },\n      withCredentials: false,\n      rejectUnauthorized: false\n    }, function (err, response) {\n      if (err) reject(err);else if (response.statusCode !== 201) reject(new Error('Failed to create topic'));else {\n        var _uri = '' + _messageServer.CHASQUI_URL + (response.headers.location || response.headers.Location);\n        resolve(_uri);\n      }\n    });\n  });\n};\n\n/**\n *  A QR Code and Chasqui Transport. The QR modal is configured for tranporting the request, while the\n *  response will be returned through Chasqui.\n *\n *  @param    {Object}       [config={}]               an optional config object\n *  @param    {String}       [config.chasquiUrl]       url of messaging server, defaults to Chasqui instance run by uPort\n *  @param    {String}       [config.pollingInterval]  milisecond interval at which the messaging server will be polled for a response\n *  @return   {Function}                               a configured QRTransport Function\n *  @param    {String}       message                   a uPort client request message\n *  @return   {Promise<Object, Error>}                 a function to close the QR modal\n */\nvar chasquiSend = function chasquiSend() {\n  var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      _ref2$chasquiUrl = _ref2.chasquiUrl,\n      chasquiUrl = _ref2$chasquiUrl === undefined ? _messageServer.CHASQUI_URL : _ref2$chasquiUrl,\n      _ref2$pollingInterval = _ref2.pollingInterval,\n      pollingInterval = _ref2$pollingInterval === undefined ? POLLING_INTERVAL : _ref2$pollingInterval,\n      displayText = _ref2.displayText;\n\n  var transport = (0, _messageServer.URIHandlerSend)(send(displayText, { compress: chasquiCompress }), { chasquiUrl: chasquiUrl, pollingInterval: pollingInterval });\n  return function (message, params) {\n    return transport(message, params).then(function (res) {\n      (0, _ui.close)();\n      return res;\n    }, function (err) {\n      (0, _ui.close)();\n      throw new Error(err);\n    });\n  };\n};\n\nexports.chasquiSend = chasquiSend;\nexports.chasquiCompress = chasquiCompress;\nexports.send = send;"},"lineCount":140}},"hash":"ffea936de9a29d398776114760adb362","cacheData":{"env":{}}}